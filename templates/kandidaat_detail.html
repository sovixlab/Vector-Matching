{% extends 'base.html' %}

{% block title %}{{ candidate.name|default:"Kandidaat" }} - Vector Matching{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-4xl font-bold text-base-content">
                {{ candidate.name|default:"Kandidaat" }}
            </h1>
            <p class="text-base-content/60 mt-2">
                Toegevoegd op {{ candidate.created_at|date:"d-m-Y H:i" }}
            </p>
        </div>
        <a href="{% url 'vector_matching_app:kandidaten' %}" class="btn btn-outline btn-primary">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Terug naar overzicht
        </a>
    </div>

    <!-- Messages -->
    {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} mb-2">
                    <span>{{ message }}</span>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Kandidaat Informatie -->
        <div class="lg:col-span-2">
            <div class="card bg-base-200 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-base-content mb-4">Kandidaat Informatie</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-base-content/70">Naam</span>
                            </label>
                            <div class="text-base-content font-medium">
                                {{ candidate.name|default:"Niet opgegeven" }}
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-base-content/70">E-mailadres</span>
                            </label>
                            <div class="text-base-content">
                                {{ candidate.email|default:"Niet opgegeven" }}
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-base-content/70">Telefoonnummer</span>
                            </label>
                            <div class="text-base-content">
                                {{ candidate.phone|default:"Niet opgegeven" }}
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-base-content/70">Opleidingsniveau</span>
                            </label>
                            <div class="text-base-content">
                                {{ candidate.education_level|default:"Niet opgegeven" }}
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-base-content/70">Jaren ervaring</span>
                            </label>
                            <div class="text-base-content">
                                {% if candidate.years_experience %}
                                    {{ candidate.years_experience }} jaar
                                {% else %}
                                    Niet opgegeven
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-base-content/70">Adres</span>
                            </label>
                            <div class="text-base-content">
                                {{ candidate.full_address|default:"Niet opgegeven" }}
                            </div>
                        </div>

                        {% if candidate.job_titles %}
                        <div class="form-control md:col-span-2">
                            <label class="label">
                                <span class="label-text text-base-content/70">Functietitels</span>
                            </label>
                            <div class="flex flex-wrap gap-2">
                                {% for title in candidate.job_titles %}
                                    <div class="badge badge-outline">{{ title }}</div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- CV Document -->
            {% if candidate.cv_pdf %}
            <div class="card bg-base-200 shadow-xl mt-6">
                <div class="card-body">
                    <h2 class="card-title text-base-content mb-4">CV Document</h2>
                    
                    <div class="flex items-center gap-4 p-4 bg-base-300 rounded-lg">
                        <svg class="w-8 h-8 text-error" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                        <div class="flex-1">
                            <div class="font-medium text-base-content">{{ candidate.cv_pdf.name|slice:"7:" }}</div>
                            <div class="text-sm text-base-content/60">PDF document</div>
                        </div>
                        <a href="{{ candidate.cv_pdf.url }}" target="_blank" class="btn btn-sm btn-primary">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                            </svg>
                            Openen
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Profiel Samenvatting (voor embedding) -->
            {% if candidate.profile_text %}
            <div class="card bg-base-200 shadow-xl mt-6">
                <div class="card-body">
                    <h2 class="card-title text-base-content mb-4">Profiel Samenvatting (voor Embedding)</h2>
                    <div class="prose prose-invert max-w-none">
                        <p class="text-base-content">{{ candidate.profile_text }}</p>
                    </div>
                    {% if candidate.embedding and candidate.embedding|length > 0 %}
                    <div class="mt-4 p-3 bg-success/10 border border-success/20 rounded-lg">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span class="text-success font-medium">Embedding gegenereerd (1536 dimensies)</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% elif candidate.cv_text and candidate.embed_status == 'failed' %}
            <div class="card bg-error/10 border border-error/20 shadow-xl mt-6">
                <div class="card-body">
                    <h2 class="card-title text-error mb-4">Verwerking Mislukt</h2>
                    <p class="text-error/80 mb-4">De CV tekst is geÃ«xtraheerd, maar de verwerking naar profiel samenvatting is mislukt.</p>
                    <div class="max-h-48 overflow-y-auto">
                        <pre class="text-sm text-error/70 whitespace-pre-wrap">{{ candidate.cv_text|truncatechars:1000 }}</pre>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Foutmelding -->
            {% if candidate.error_message %}
            <div class="card bg-error/10 border border-error/20 shadow-xl mt-6">
                <div class="card-body">
                    <h2 class="card-title text-error mb-4">Foutmelding</h2>
                    <div class="text-error/80">
                        <p><strong>Stap:</strong> {{ candidate.processing_step }}</p>
                        <p><strong>Fout:</strong> {{ candidate.error_message }}</p>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Status & Acties -->
        <div class="space-y-6">
            <!-- Embed Status -->
            <div class="card bg-base-200 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-base-content mb-4">Verwerkingsstatus</h2>
                    
                    <div class="flex items-center gap-3 mb-4">
                        <div class="badge {{ candidate.embed_status_badge_class }} gap-1 text-lg">
                            {{ candidate.embed_status_icon }}
                            {{ candidate.get_embed_status_display }}
                        </div>
                    </div>

                    <div class="text-sm text-base-content/60">
                        <div>Laatst bijgewerkt: {{ candidate.updated_at|date:"d-m-Y H:i" }}</div>
                        <div>Toegevoegd: {{ candidate.created_at|date:"d-m-Y H:i" }}</div>
                        {% if candidate.processing_step %}
                        <div>Huidige stap: {{ candidate.processing_step }}</div>
                        {% endif %}
                        {% if candidate.latitude and candidate.longitude %}
                        <div>Locatie: {{ candidate.latitude|floatformat:4 }}, {{ candidate.longitude|floatformat:4 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Acties -->
            <div class="card bg-base-200 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-base-content mb-4">Acties</h2>
                    
                    <div class="space-y-3">
                        {% if candidate.cv_pdf %}
                        <a href="{% url 'vector_matching_app:kandidaat_cv' candidate.id %}" target="_blank" class="btn btn-primary w-full">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            CV Bekijken
                        </a>
                        {% endif %}

                        <a href="{% url 'vector_matching_app:kandidaat_edit' candidate.id %}" class="btn btn-outline btn-warning w-full">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            Bewerken
                        </a>

                        <form method="post" action="{% url 'vector_matching_app:kandidaat_reprocess' candidate.id %}" class="w-full">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline btn-info w-full">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Opnieuw verwerken
                            </button>
                        </form>

                        <form method="post" action="{% url 'vector_matching_app:kandidaat_delete' candidate.id %}" class="w-full">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline btn-error w-full" 
                                    onclick="return confirm('Weet je zeker dat je deze kandidaat wilt verwijderen?')">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                                Verwijderen
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
